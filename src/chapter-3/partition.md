

# 分区

为了对存储设备进行数字划分和管理，人们创造了分区的概念。作为动词，分区将磁盘的数字空间划分出不同功能和大小的区域；作为名词，分区指的的是划分出的区域。

## 基本概念

### 扇区

扇区将存储空间划分成一个个块，并给块编号，块的编号也就是扇区的地址

#### 物理扇区

此处的物理扇区指的是一个存储设备所能访问的最小的存储单元。一般物理扇区由存储设备的硬件和固件所决定，如三星PM981A固态硬盘的物理扇区大小为4096Bytes



### 分区表

分区表又可称为存储设备分区形式、分区结构，一般有MBR和GPT两种。分区表用于记录在设备上的各个分区的位置，分区承载了何种文件系统，告知主板固件每个分区承载何种功能，存储启动代码等等

#### MBR

MBR即主引导记录，英文全名为Master Boot Record，占据存储设备起始的512Bytes的空间。特点是适合2TiB以下的硬盘，如果是启动系统的硬盘需要根据主板的固件进行选择，一般较老的电脑(运行Windows XP/2000/2003等一般不支持GPT分区表的系统)使用MBR

#### GPT

GPT即GUID分区表，英文全名为GUID Partition Table。GPT分区表的特点是相比MBR的32位扇区，GPT扩展到64位扇区，可以支持最大支持$2^{64}*512 Byte= 8 ZiB$的硬盘容量大小，如果是启动系统的硬盘需要根据主板的固件进行选择，一般较新的电脑(运行Windows 8/10等支持GPT分区表和UEFI启动的系统)使用GPT


### 分区类型-不同的分区功能

可以依据分区承载的功能不同来划分分区的类型

以Windows系统为例，分区可以分为系统分区、恢复分区、Windows分区和数据分区

- 系统分区：存放用于系统启动、系统级加解密(Bitlocker)等维持操作系统运行、修复的文件和数据的分区，如EFI分区、MSR分区
- 恢复分区：存放用于修复系统、恢复出厂设置等在系统无法启动的情况下恢复系统可运行状态所需文件和数据的分区，如Recovery分区
- Windows分区：存放Windows操作系统文件，支持操作系统运行的分区，一般指的”C盘“就是此分区
- 数据分区：存放个人文件等无关系统启动、恢复、运行的分区

### 分区类型-文件系统格式

文件系统格式又称文件系统类型，可以依据文件系统格式的不同来划分分区的类型，不同的文件系统格式往往意味着不同的特性和功能。

本文介绍FAT32、exFAT、NTFS、APFS这四种文件系统

- FAT32：历史悠久的文件系统，被各种系统广泛兼容，缺点是最大支持4GB的单文件，容易产生文件碎片
- exFAT：微软所开发的文件系统，在最新的各种系统中被广泛兼容，适合作为小容量U盘和闪存的文件系统
- NTFS：微软所专有的文件系统，可以作为微软系统的Windows分区，在非微软系统中写入的兼容性不佳，适合用作移动硬盘的文件系统
- APFS：苹果所专有的文件系统， High Sierra 10.13之后被广泛用于苹果的各种系统中，放到苹果以外的系统上一般都读不出来

### 盘符

盘符又称为驱动器号，是当前操作系统指派的用于访问某个分区的符号，比如Windows习惯将当前运行的Windows分区指派”C“，也就是”C盘“的来源，可以通过磁盘管理对盘符进行删除和分配(Windows为了保护系统，禁止修改系统分区和Windows分区的盘符)，盘符只在当前系统下具有意义，如在一个资源管理器下显示了四个分区的系统下插入一个优盘，盘符可能与资源管理器下显示了一个分区的系统下插入一个优盘的盘符分配不同。

### 重命名

重命名是对一个分区(卷标)进行重新命名的操作，比如将”C盘“命名为”Windows“，分区的名字不会因为访问分区的系统不同而改变，比如给一个优盘的一个分区起名为”新加卷“，那么当这个优盘被插入到其他电脑上，也会显示为”新加卷“

### 格式化

警告：格式化会导致分区内文件丢失！

(高级)格式化是对分区进行初始化的操作，将会导致这个分区的文件将不再可以被文件系统访问。在格式化的时候可以对文件系统进行配置，简单的格式化方式是在资源管理器中右键需要格式化的分区，选择格式化，然后选择需要格式化成的文件系统，建议勾选快速格式化以加快格式化的速度。



## 使用磁盘管理程序进行分区

可以右键开始菜单选择磁盘管理打开Windows内置的磁盘管理程序，也可以使用Win+R快捷键调出”运行“对话框，输入”diskmgmt.msc“打开磁盘管理。此处的磁盘就是一般意义上的存储设备。以下操作均在磁盘管理程序中进行。

### 初始化磁盘

警告：如果是一块已经有文件的磁盘却被识别成未初始化状态，请联系专业人员进行处理！

当新购买一个固态硬盘、台式机硬盘或者优盘装入一个电脑后，可能出现在资源管理器中看不到新添加的设备的情况，此时，需要对磁盘进行初始化或是分配盘符。

初始化磁盘会擦除磁盘上的所有内容，并写入分区表。

在“磁盘管理”中，右键单击想要初始化的磁盘，然后单击“初始化磁盘”  。 注：某些 USB 驱动器没有初始化选项，它们只是格式化并获取一个驱动器号。

在“初始化磁盘”  对话框中，检查以确保选择了正确磁盘，然后单击“确定”  以所选的分区表格式(MBR或GPT)作为这个磁盘的分区表格式。 

### 添加分区

右键单击所需添加分区磁盘上的未分配空间(空白部分)，如果没有说明没有未分配空间，然后选择“新建简单卷”  。

选择“下一步”，指定分区(卷)的大小（默认是整块未分配空间的大小），然后选择“下一步”   。

选择分区的盘符，然后选择“下一步”  。

分区的文件系统（通常为 NTFS），选择“下一步”，然后选择“完成”   。

### 删除分区

警告：删除分区将会导致被删除的分区内的文件丢失，如果误操作请立刻停止操作并移除存储设备并关闭系统，将存储设备通过其他电脑挂载并找回分区！

右键单击所需删除分区，选择”删除卷“。

查看并知晓弹出的警告窗口”删除此卷将清除其上的所有数据，请在删除之前备份所有希望保存的数据。你想继续吗？“，选择”是“，分区就被删除了。

### 修改盘符

右键单击所需修改盘符的分区，选择”更改驱动器号和路径“，在弹出的窗口中，可以修改、添加、删除这个分区的盘符。

## 分区进阶

警告：如果没有充分考虑每个操作可能产生的后果，请预先在不重要的设备或虚拟机中进行操作，不正确的操作和操作序列可能导致文件不可逆的丢失和系统损坏！

### 使用Diskpart命令行程序进行分区

Diskpart是一个强大的命令行磁盘控制程序，内置于Windows 2000/XP/7/8/10等操作系统中，通过使用Diskpart工具，无需使用其他第三方程序，即可完成对Windows分区的管理。

Diskpart具有相当强大的功能，这里只抛砖引玉，介绍具有代表性和最为常用的一部分功能，以在Windows 10版本中的Diskpart为例，对于不同版本的Windows附带的Diskpart，功能略有差异。

对象：这里介绍Diskpart中的两种对象：磁盘(disk)和分区(partition),分区属于某一个磁盘，因此需要选定一个磁盘才能对磁盘下对应的分区进行操作。

基本操作：列出(list)、选定(select)、详细信息(detail)对象：例如使用"list disk"(所有命令输入时不含引号，此后不再赘述)来列出所有的磁盘，使用"select disk 0"来选定磁盘0，使用"detail disk"来列出上一步操作中磁盘0的详细信息(包括磁盘设备名称、ID、类型、状态、磁盘下属的分区和分区信息等等)，对分区的操作在选定磁盘后和磁盘是一样的。

创建分区：在选定磁盘以后，例如使用"create partition primary size=1000"，在最大的空闲空间处创建一个大小为1000MB(size=1000)的未安装文件系统的主分区，创建分区后会自动选定这个分区，对于GPT分区表，使用"create partition efi size=300"在最大的空闲空间处创建一个大小为300MB(size=300)的efi文件系统分区，创建分区后会自动选定这个分区。size是设定以MB为大小的单位的参数，如果不使用这个参数，将会使用尽可能大的size。

删除分区：在选定想要删除的分区以后，例如使用"delete partition"来删除选定的分区，如果是恢复分区或者efi类型的受保护分区，就要例如使用"delete partition override"进行删除

格式化分区：在选定想要格式化的分区以后，例如使用"format fs=ntfs quick"来快速格式化选定的分区为NTFS文件系统。

分配盘符：一般情况下格式化分区后是不会分配新的盘符的，例如使用"assign letter=f"来将盘符f分配给选定的分区。

### 使用易数Diskgenius或傲梅分区助手软件进行分区

如果不仅需要对FAT/NTFS类型的分区进行管理，或者需要进行分区表备份/恢复、迁移系统等操作，建议使用上述两款著名的第三方磁盘管理软件进行操作。

#### 易数Diskgenius

[官方网站](www.diskgenius.cn)

#### 傲梅分区助手

[官方网站](www.disktool.cn)



## 参考资料

- [Master_Boot_Record](https://en.wikipedia.org/wiki/Master_Boot_Record)
- [[科普] 终于明白什么叫 55 AA 了](http://bbs.mydigit.cn/read.php?tid=597024)
- [hard-drives-and-partitions](https://docs.microsoft.com/en-us/windows-hardware/manufacture/desktop/hard-drives-and-partitions)
- [深入解析Windows操作系统 第四版](https://book.douban.com/subject/2031396/)
- [磁盘管理概述](https://docs.microsoft.com/zh-cn/windows-server/storage/disk-management/overview-of-disk-management)

